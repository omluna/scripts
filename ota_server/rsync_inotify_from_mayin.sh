################################################################################## Install#### On DestServer### Create user accountuseradd -m rsyncpasswd rsync					# Set passwrod to "xxxxxxxxx"### Install rsynccd /root/so/softwaretar zxvf rsync-3.0.9.tar.gzmv rsync-3.0.9 rsynccd rsync./configuremake && make installcd /root/so/softwarerm -rf rsync rsync-3.0.9.tar.gz### Config rsync## Create config filevi /etc/rsync.confuid = rootgid = rootuse chroot = nomax connections = 20strict modes = yeslog file = /var/log/rsyncd.logpid file = /var/run/rsyncd.pidlock file = /var/run/rsync.locklog format = %t %a %m %f %b[test]path = /home/rsync_dir/auth users = rsyncread only = nohosts allow = 192.168.111.129list = nouid = rootgid = rootsecrets file = /etc/rsync.secureignore errors = yestimeout = 120#dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz### Create password filevi /etc/rsync.secure:rsync:xxxxxxxxx# chmodchmod 600 /etc/rsync.secure### Auto-startecho "rsync --daemon --config=/etc/rsync.conf" >> /etc/rc.local### Startrsync --daemon --config=/etc/rsync.conf# netstat -anl | grep 873### Restart (for reference only)# kill `cat /var/run/rsyncd.pid` && rsync --daemon --config=/etc/rsync.conf#### On SourceServer### Install rsynccd /root/so/softwaretar zxvf rsync-3.0.9.tar.gzmv rsync-3.0.9 rsynccd rsync./configuremake && make installcd /root/so/software# rm -rf rsync rsync-3.0.9.tar.gz## Config for rsync not required.### Create password filevi /etc/rsync-client.secure:xxxxxxxxx						# Only password written here# chmodchmod 600 /etc/rsync-client.secure=========================================### Install inotifycd /root/so/softwaretar zxvf inotify-tools-3.14.tar.gzmv inotify-tools-3.14 inotifycd inotify./configuremake && make installcd /root/so/software# rm -rf inotify inotify-tools-3.14.tar.gz### Create shell scriptvi /root/so/tools/inotify_rsync.sh:#!/bin/shUSER=rsync								# Same as the data for "auth users" defined in /etc/rsync.conf on DestServerDS1=10.200.230.126						# IP of DestServer#DS2=192.168.1.103SRCDIR=/usr/local/nginx/html/			# Local source dir to monitor, changes for the dir will be synced to DestServerDEST=test								# Same as the module name defined in /etc/rsync.conf on DestServer/usr/local/bin/inotifywait -mrq -e create,move,delete,modify $SRCDIR | while read D E Fdo    rsync -ahqzt --password-file=/etc/rsync-client.secure --delete ${SRCDIR} ${USER}@${DS1}::${DEST}    # rsync -ahqzt --password-file=/etc/rsync-client.secure --delete ${SRCDIR} ${USER}@${DS2}::${DEST}done## chmodchmod +x /root/so/tools/inotify_rsync.sh## Auto-startecho "nohup /root/so/tools/inotify_rsync.sh &" >> /etc/rc.local## Startnohup /root/so/tools/inotify_rsync.sh &#### Verify### On SourceServercd /usr/local/nginx/html/					# The "SRCDIR" defined in /root/so/tools/inotify_rsync.sh## Create new file for testvi testfile-new.txt### On DestServercd /data/www/test/html/						# The "path" defined in /etc/rsync.conf on DestServerll############################################################################################################################################################### Reference#### Confighttp://www.cnblogs.com/hbycool/articles/2159392.html#### rsynchttp://rsync.samba.org/ftp/rsync/src/rsync-3.0.9.tar.gzhttp://rsync.samba.org/ftp/rsync/src/rsync-patches-3.0.9.tar.gz# Find the link above via http://rsync.samba.org/#### inofifyhttp://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz# Find the line above via https://github.com/rvoicilas/inotify-tools/wiki/#############################################################################